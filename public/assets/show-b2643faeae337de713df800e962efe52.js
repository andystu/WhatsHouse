function initialize(){var a=12;map=L.map("map_canvas").setView([22.999255,120.215013],a),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map),markerCluster=L.markerClusterGroup(),markers=[];for(var e=gon.real_price_list,s=0;s<e.length;s++)createMarker(e[s],markers);markerCluster.addLayers(markers),map.addLayer(markerCluster)}function createMarker(a,e){var s=L.marker([a.lat,a.lng]);s.id=a.id,s.data=a.data,s.lat=a.lat,s.lng=a.lng,s.on("click",function(){console.log("click"),console.log(s.id),$("div.ui.inverted.red.pointing.response.menu .item").tab("change tab","Information").tab("deactivate all").tab("activate tab","Information").tab("activate navigation","Information"),window.location.hash="Information",$("#area").show(),(focusPoint.lat!==s.lat||focusPoint.lng!==s.lng)&&(focusPoint.lat=s.lat,focusPoint.lng=s.lng,deleteAround(),$(".form .fields .checkbox").checkbox("disable"),jQuery.ajax({url:"/events/house_detail",dataType:"json",type:"GET",data:{real_price_id:s.id,data:s.data,lat:s.lat,lng:s.lng},success:function(a){for(i=0;i<a.length;++i)if("sale_houses"==a[i].data)$("#information").html('<span class="left-information"><div class="orange ui ribbon label">\u985e\u578b</div><p>'+a[i].use+'</p></span><span class="right-information"><div class="orange ui ribbon label">\u683c\u5c40</div><p>'+a[i].structure+'</p></span><span class="left-information"><div class="orange ui ribbon label">\u5730\u5740</div><p>'+a[i].address+'</p></span><span class="right-information"><div class="orange ui ribbon label">\u552e\u50f9</div><p>'+a[i].price+'</p></span><span class="left-information"><div class="orange ui ribbon label">\u806f\u7d61\u4eba</div><p>'+a[i].owner+'</p></span><span class="right-information"><div class="orange ui ribbon label">\u806f\u7d61\u96fb\u8a71</div><p>'+a[i].tel+'</p></span><span class="brief"><div class="orange ui ribbon label">\u520a\u767b\u8cc7\u8a0a</div><p>'+a[i].breif+"</p></span>");else if("rent_houses"==a[i].data){getHouse=a[i],$("#information").html('      <div class="add_to_cart ui orange left corner label" onclick="addToCart()"><i class="add icon"></i></div><div class="ui right corner label"><div class="text">\u9ede\u64ca\u7387'+a[i].browse_rate+'</div></div><table class="ui table segment row" cellpadding="0" cellspacing="0" border="0"><tbody><tr class="address row"><td class="first"><i class="map marker icon"></i>\u5730\u5740</td><td class="second"><p>'+a[i].address+'</p></td></tr><tr class="price row"><td class="first"><i class="dollar icon"></i>\u79df\u91d1</td><td class="second"><p>'+a[i].price+'\u5143/\u6bcf\u6708</p></td></tr><tr class="type row"><td class="first"><i class="home icon"></i>\u985e\u578b</td><td class="second"><p>'+a[i].use+'</p></td></tr><tr class="structure row"><td class="first"><i class="building icon"></i>\u683c\u5c40</td><td class="second"><p>'+a[i].structure+'</p></td</tr><tr class="pepple row"><td class="first"><i class="users icon"></i>\u4eba\u6578</td><td class="second"><p>'+a[i].people+'</p></td></tr><tr class="contact row"><td class="first"><i class="user icon"></i>\u806f\u7d61\u4eba</td><td class="second"><p>'+a[i].owner+'</p></td></tr><tr class="tel row"><td class="first"><i class="phone icon"></i>\u806f\u7d61\u96fb\u8a71</td><td class="second"><p>'+a[i].tel+'</p></td></tr><tr class="infor row"><td class="first" id="main_infor"><i class="info icon"></i>\u520a\u767b\u8cc7\u8a0a<td><p>'+a[i].breif+"</p></td></tr><tbody></talbe>");var e=splitImgUrl(a[i].img);e&&($("#slider1_container").html('<div id = "images" u="slides">'+e+"</div>"),jssor_slider1_starter("slider1_container")),console.log(a[i].address)}else"real_price_deals"==a[i].data?$("#information").html('"<div class="red ui ribbon label">\u9109\u93ae\u5e02\u5340</div><p>'+a[i].area+'</p>"<div class="green ui ribbon label">\u571f\u5730\u8def\u6bb5</div><p>'+a[i].location+'</p>"<div class="blue ui ribbon label">\u7e3d\u6210\u4ea4\u50f9</div><p>'+a[i].total_price+"\u5143</p>"):(a[i].data in around||(console.log("found "+a[i].data),around[a[i].data]=[]),addAroundMarker(a[i]));$("#around_services").find("input").each(function(){var a=$(this).attr("name"),e=$(this).next("label").attr("id");$(this).next("label").text(a in around?e+" ("+around[a].length+")":e+" (0)")})},error:function(a){alert("something went wrong"),console.error(a)}}),DISQUS.reset({reload:!0,config:function(){this.page.identifier=s.id,this.page.url="https://whatshouse.herokuapp.com/#!newthread"}}))}),e.push(s),id_markers[s.id]=s}function addAroundMarker(a){if("police_stations"===a.data)for(var e in around.police_stations)if(e.addr===a.addr)return;var s="";"stores"===a.data?s="/assets/stores-809f532ff0ae94c8a017caeb292d0411.jpg":"stations"===a.data?s="/assets/stations-9d5b047b6dc5b12f04365d8523ed9476.png":"dinings"===a.data?s="/assets/dinings-ba840dc6932c0ffd5f44957857c3edd3.png":"tainan_schools"===a.data?s="/assets/tainan_schools-7040a2104329ad7005a23fbe869761b1.png":"tainan_markets"===a.data?s="/assets/tainan_markets-11d6a9069092f7f8c680d9426619d40b.png":"hospitals"===a.data?s="/assets/hospitals-bfa08ab7f248fdeb9dc2c3649bc8a593.png":"police_stations"===a.data?s="/assets/police_stations-f43170ee6b5a13a52ec83eb215ec5601.png":"gas_stations"===a.data?s="/assets/gas_stations-01da8ffa49c95c136f68445a7e48719c.png":"post_offices"===a.data?s="/assets/post_offices-68ed4a780906b045b1914d805cf42299.png":"subways"===a.data&&(s="/assets/subways-3a8633e57abcaa4518ba528b8daf6467.png");var i=L.icon({iconUrl:s,iconSize:[30,30]}),r=L.marker([a.lat,a.lng],{icon:i});r.id=a.id,r.data=a.data,r.lat=a.lat,r.lng=a.lng;var t="";for(var n in a)"name"===n?t+="<p>\u540d\u7a31: "+a.name+"</p>":"address"===n?t+="<p>address: "+a.address+"</p>":"addr"===n?t+="<p>addr: "+a.addr+"</p>":"location"===n?t+="<p>location: "+a.location+"</p>":"breif"===n?t+="<p>brief: "+a.breif+"</p>":"tel"===n?t+="<p>tel: "+a.tel+"</p>":"time"===n&&(t+="<p>time: "+a.time+"</p>");r.bindPopup(t),around[a.data].push(r)}function showAround(a){if("all"!==a)a in around&&(aroundLayers[a]=L.layerGroup(around[a]),map.addLayer(aroundLayers[a]));else for(var e in around)aroundLayers[e]=L.layerGroup(around[e]),map.addLayer(aroundLayers[e])}function hideAround(a){if("all"!==a)a in around&&map.removeLayer(aroundLayers[a]);else for(var e in around)aroundLayers[e]&&map.removeLayer(aroundLayers[e])}function deleteAround(){hideAround("all"),around={},aroundLayers={}}function setAllMap(){markerCluster=L.markerClusterGroup(),markerCluster.addLayers(markers),map.addLayer(markerCluster)}function clearMarkers(){map.removeLayer(markerCluster)}function deleteMarkers(){clearMarkers(),markers=[]}function search(){$(".search_form, .menu_search_form").on("ajax:success",function(a,e){deleteMarkers(),deleteAround(),$("div.ui.inverted.red.pointing.response.menu .item").tab("change tab","Advanced_Search").tab("deactivate all").tab("activate tab","Advanced_Search").tab("activate navigation","Advanced_Search"),window.location.hash="Advanced_Search";var s=e[1];if(" "!=s&&e[0].length>0)$("div.ui.form.success").hide(),$("div#search_show").html('<span id="serach_rating">\u641c\u5c0b\u6392\u540d</span><button class="undo ui orange mini icon button" onclick="searchUndo()"><i class="undo icon"></i></button><ol id=\'search_result\'>'),appendSerachContent(e,s);else if(e[0].length>0){$("div.ui.form.success").hide(),$("div#search_show").html('<span id="serach_rating">\u641c\u5c0b\u7d50\u679c(\u986f\u793a\u524d\u4e09\u7b46)</span><button class="undo ui mini orange icon button" onclick="searchUndo()"><i class="undo icon"></i></button><ol id=\'search_result\'>'),appendSerachContent(e,s);var i=new L.LatLng(e[0][0].lat,e[0][0].lng);map.setView(i,13)}else $("div.ui.form.success").hide(),$("div#search_show").html('<span id="serach_rating">\u641c\u5c0b\u7d50\u679c(0\u7b46)</span><button class="undo ui mini orange mini icon button" onclick="searchUndo()"><i class="undo icon"></i></button>');for(var r=e[0],t=0;t<r.length;t++)createMarker(r[t],markers);setAllMap(),$("div#advanced_search form").hide(),$("div#search_show").show()})}function appendSerachContent(a,e){for(var s,i=0;3>i&&i<a[0].length;++i)s=" "!=e?a[0][e[e.length-i-1]]:a[0][i],$("#search_result").append("<li><a class='marker_link' href='#' id='"+s.id+"' onclick='moveToMarker(event,this.id)'>"+s.address+" "+s.price+"\u5143</a></li>");$("#search_result").append("</ol>")}function moveToMarker(a,e){a.preventDefault();var s=[id_markers[e].lat,id_markers[e].lng];map.setView(s),map.setZoom(17)}function searchUndo(){$("div#advanced_search form").show(),$("div#search_show").hide()}function initalCheckbox(){$(".form .fields .checkbox").checkbox("disable"),$(".form .fields .checkbox").checkbox(),$(".form .fields .checkbox").click(function(){$(this).children("input").is(":checked")?showAround($(this).children("input").attr("name")):hideAround($(this).children("input").attr("name"))})}function splitImgUrl(a){if(a)for(var e=a.split(","),s="",i=0;i<e.length;i++)s+='<div><img u="image" src="'+e[i]+'" /></div>';else s+='<div><img u="image" src="/assets/006-478d54e638f6433fb02bd72f727032a5.jpg" /></div>',s+='<div><img u="image" src="/assets/006-478d54e638f6433fb02bd72f727032a5.jpg" /></div>';return s}function addToCart(){var a=4,e=1;return $("div.ui.inverted.red.pointing.response.menu .item").tab("change tab","List").tab("deactivate all").tab("activate tab","List").tab("activate navigation","List"),window.location.hash="List",a>=house_number&&(house_array.push(getHouse),e++,$(".cart").append('<li><i class="map marker icon"></i><div class="content"><span class="header"><a href="#" onclick="moveToMarker(event,this.id)" id="'+getHouse.id+'">'+getHouse.address+" "+getHouse.price+'$ </a></span><a href="#" onclick="removeFromCart(this)" id="house'+house_number+'" class="removeclass">x</a></div></li>'),house_number++),!1}function removeFromCart(a){return house_number>=1&&(delete house_array[a.id[4]],$(a).parents("li").remove(),house_number--),!1}var map,services,around={},aroundLayers=[],markers=[],markerCluster,getHouse,id_markers={},focusPoint={lat:null,lng:null},house_number=$(".cart").length,house_array=[];$(document).ready(initalCheckbox);